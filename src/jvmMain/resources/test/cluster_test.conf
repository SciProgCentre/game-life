akka {
  actor {
    provider = "cluster"
    allow-java-serialization = true

    serializers {
      java = "akka.serialization.JavaSerializer"
    }
    serialization-bindings {
      "space.kscience.simba.engine.Message" = java
      "space.kscience.simba.akka.MainActorMessage" = java
    }
  }

#   serialization.jackson {
#     jackson-modules += "com.fasterxml.jackson.module.kotlin.KotlinModule"
#   }

  remote.artery {
    canonical.port = 2551
  }

  cluster {
    downing-provider-class = "akka.cluster.sbr.SplitBrainResolverProvider"

    shutdown-after-unsuccessful-join-seed-nodes = 120s

    sharding {
      least-shard-allocation-strategy.rebalance-absolute-limit = 20
      passivation.strategy = default-strategy
#       state-store-mode = persistence
      remember-entities = on # https://doc.akka.io/docs/akka/current/typed/cluster-sharding.html#remembering-entities
      remember-entities-store = eventsourced
#       journal-plugin-id = "akka.persistence.journal.proxy"
#       snapshot-plugin-id = "akka.persistence.snapshot-store.proxy"
    }
  }

#   seed-nodes = [
#     "akka://AkkaSystem@127.0.0.1:2551",
#     "akka://AkkaSystem@127.0.0.1:2552",
#     "akka://AkkaSystem@127.0.0.1:2553"
#   ]
}

akka.management {
  http {
    port = 8558
    port = ${?HTTP_MGMT_PORT}
  }
}
